!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TQSDK=t():e.TQSDK=t()}(window,function(){return function(i){var n={};function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}return r.m=i,r.c=n,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.d(t,"a",function(){return n});var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.handlers={}}var t,i,n;return t=e,(i=[{key:"once",value:function(e,t){(this.handlers[e]||(this.handlers[e]=[])).push({once:!0,func:t})}},{key:"addEventListener",value:function(e,t){(this.handlers[e]||(this.handlers[e]=[])).push({once:!1,func:t})}},{key:"removeEventListener",value:function(e,t){if(Array.isArray(this.handlers[e])){for(var i=this.handlers[e],n=0;n<i.length;n++)if(i[n].func===t){this.handlers[e].splice(n,1);break}0===this.handlers[e].length&&delete this.handlers[e]}}},{key:"fire",value:function(e,t){if(Array.isArray(this.handlers[e]))for(var i=this.handlers[e].slice(),n=0;n<i.length;n++)i[n].func.call(this,t),i[n].once&&this.removeEventListener(e,i[n].func)}}])&&r(t.prototype,i),n&&r(t,n),e}()},function(e,t,i){"use strict";i.d(t,"c",function(){return n}),i.d(t,"a",function(){return r}),i.d(t,"b",function(){return o});var n=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"/";return Array.isArray(e)||(e=e.split(t)),e.filter(function(e){return""!==e})},r=function(e){return 0===Object.keys(e).length},o=function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8,t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),i="",n=0;n<e;n++)i+=t[62*Math.random()|0];return i}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return TqWebsocket});var _event__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var TqWebsocket=function(_EventPrototype){function TqWebsocket(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,TqWebsocket),t=_possibleConstructorReturn(this,_getPrototypeOf(TqWebsocket).call(this)),e instanceof Array?t.urlList=e:t.urlList=[e],t.ws=null,t.queue=[],t.reconnect=!0,t.reconnectTask=null,t.reconnectInterval=i.reconnectInterval?i.reconnectInterval:3e3,t.reconnectMaxTimes=i.reconnectMaxTimes?i.reconnectMaxTimes:5,t.reconnectTimes=0,t.reconnectUrlIndex=0,t.STATUS={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},t.init(),t}return _inherits(TqWebsocket,_EventPrototype),_createClass(TqWebsocket,[{key:"send",value:function(e){var t="string"==typeof e?e:JSON.stringify(e);this.isReady()?this.ws.send(t):this.queue.push(t)}},{key:"isReady",value:function(){return this.ws.readyState===this.STATUS.OPEN}},{key:"init",value:function init(){this.ws=new WebSocket(this.urlList[this.reconnectUrlIndex]),this.reconnectUrlIndex===this.urlList.length-1&&(this.reconnectTimes+=1);var _this=this;this.ws.onmessage=function(message){var data=eval("("+message.data+")");_this.fire("message",data)},this.ws.onclose=function(e){console.log("close",e),_this.fire("close"),_this.queue=[],_this.reconnect&&(_this.reconnectMaxTimes<=_this.reconnectTimes?_this.fire("death"):_this.reconnectTask=setInterval(function(){3===_this.ws.readyState&&(_this.reconnectUrlIndex=_this.reconnectUrlIndex+1<_this.urlList.length?_this.reconnectUrlIndex+1:0,_this.init(),_this.fire("reconnect"))},_this.reconnectInterval))},this.ws.onerror=function(e){console.error(e),_this.fire("error",e),_this.ws.close()},this.ws.onopen=function(){for(_this.reconnectTimes=0,_this.reconnectUrlIndex=0,_this.fire("open"),this.reconnectTask&&clearInterval(_this.reconnectTask);0<_this.queue.length&&1===_this.ws.readyState;)_this.ws.send(_this.queue.shift())}}}]),TqWebsocket}(_event__WEBPACK_IMPORTED_MODULE_0__.a)},function(e,t){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"===("undefined"==typeof window?"undefined":i(window))&&(n=window)}e.exports=n},function(e,t,i){"use strict";var o=i(0);function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n={QUOTE:function(){function e(){r(this,e),this.instrument_id="",this.datetime="",this._last_price="-",this.ask_price1="-",this.ask_volume1="-",this.bid_price1="-",this.bid_volume1="-",this.highest="-",this.lowest="-",this.open="-",this.close="-",this.average="-",this.volume="-",this.amount="-",this.open_interest="-",this.lower_limit="-",this.upper_limit="-",this.settlement="-",this.change="-",this.change_percent="-",this.strike_price=NaN,this.pre_open_interest="-",this.pre_close="-",this.pre_volume="-",this._pre_settlement="-",this.margin="-",this.commission="-"}var t,i,n;return t=e,(i=[{key:"setChange",value:function(){Number.isFinite(this._last_price)&&Number.isFinite(this._pre_settlement)&&0!=this._pre_settlement&&(this.change=this._last_price-this._pre_settlement,this.change_percent=this.change/this._pre_settlement*100)}},{key:"last_price",set:function(e){this._last_price=e,this.setChange()},get:function(){return this._last_price}},{key:"pre_settlement",set:function(e){this._pre_settlement=e,this.setChange()},get:function(){return this._pre_settlement}}])&&s(t.prototype,i),n&&s(t,n),e}(),KLINE:function e(){r(this,e),this.datetime=0,this.open=NaN,this.close=NaN,this.high=NaN,this.low=NaN,this.open_oi=0,this.close_oi=0,this.volume=0},TICK:function e(){r(this,e),this.datetime=0,this.last_price=NaN,this.average=NaN,this.highest=NaN,this.lowest=NaN,this.ask_price1=NaN,this.ask_volume1=0,this.bid_price1=NaN,this.bid_volume1=0,this.volume=0,this.amount=NaN,this.open_interest=NaN},TRADE:function e(){r(this,e),this.user_id="",this.order_id="",this.trade_id="",this.exchange_id="",this.instrument_id="",this.exchange_trade_id="",this.direction="",this.offset="",this.volume=0,this.price=0,this.trade_date_time=0,this.commission=0,this.seqno=0},ORDER:function e(){r(this,e),this.user_id="",this.order_id="",this.exchange_id="",this.instrument_id="",this.direction="",this.offset="",this.volume_orign=0,this.price_type="",this.limit_price=0,this.time_condition="",this.volume_condition="",this.this.insert_date_time=0,this.exchange_order_id="",this.this.volume_left=0,this.frozen_margin=0,this.last_msg="",this.seqno=0},POSITION:function e(){r(this,e),this.user_id="",this.exchange_id="",this.instrument_id="",this.volume_long_today=0,this.volume_long_his=0,this.volume_long=0,this.volume_long_frozen_today=0,this.volume_long_frozen_his=0,this.volume_long_frozen=0,this.volume_short_today=0,this.volume_short_his=0,this.volume_short=0,this.volume_short_frozen_today=0,this.volume_short_frozen_his=0,this.volume_short_frozen=0,this.open_price_long=0,this.open_price_short=0,this.open_cost_long=0,this.open_cost_short=0,this.position_price_long=0,this.position_price_short=0,this.position_cost_long=0,this.position_cost_short=0,this.last_price=0,this.float_profit_long=0,this.float_profit_short=0,this.float_profit=0,this.position_profit_long=0,this.position_profit_short=0,this.position_profit=0,this.margin_long=0,this.margin_short=0,this.margin=0},BANK:function e(){r(this,e),this.id="",this.name=""},ACCOUNT:function e(){r(this,e),this.currency="",this.balance=NaN,this.available=NaN,this.pre_balance=NaN,this.deposit=NaN,this.withdraw=NaN,this.commission=NaN,this.premium=NaN,this.static_balance=NaN,this.position_profit=NaN,this.float_profit=NaN,this.risk_ratio=NaN,this.margin=NaN,this.frozen_margin=NaN,this.frozen_commission=NaN,this.frozen_premium=NaN,this.close_profit=NaN}},c=function(e){return new(n[e.toUpperCase()])},a=i(1);function u(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var p=function(e,r){var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;return new Proxy(e,{get:function(e,t,i){if(isNaN(t))return["last_id","trading_day_start_id","trading_day_end_id"].includes(t)?r[t]:e[t];var n=Number(t);return n<0?NaN:o?o(e[n]):e[n]}})},m=function e(t,i){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];for(var o in i){var s=i[o];switch(d(s)){case"object":if(null===s){r&&o&&delete t[o];continue}if(Array.isArray(s)||"data"===o?o in t||(t[o]=[]):o in t||(t[o]={}),"quotes"===o)for(var a in s){var u=s[a];null!==u?(t[o][a]||(t[o][a]=c("quote")),e(t[o][a],u,n,r)):r&&a&&delete t[o][a]}else e(t[o],s,n,r);break;case"string":case"boolean":case"number":t[o]="NaN"===s?NaN:s}}t._epoch||Object.defineProperty(t,"_epoch",{configurable:!1,enumerable:!1,writable:!0}),t._epoch=n},y=function(e){function t(){var e;return function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=f(this,h(t).call(this)))._epoch=0,e._data={quotes:{},klines:{},ticks:{},charts:{}},e}var i,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,o["a"]),i=t,(n=[{key:"getKlines",value:function(e,t){if(""===e)return null;var i=this._getByPath(["klines",e,t]);if(i&&i.data&&-1!==i.last_id||m(this._data,{klines:u({},e,u({},t,{last_id:-1,data:{}}))},this._epoch-1,!1),!(i=this._getByPath(["klines",e,t])).proxy){i.proxy=p(i.data,i);["open","close","high","low","volume","close_oi","open_oi","datetime"].forEach(function(t){i.data[t]=p(i.data,i,function(e){return e?e[t]:NaN})})}return i.proxy}},{key:"getTicks",value:function(e){if(""===e)return null;var i=this._getByPath(["ticks",e]);if(i&&i.data||m(this._data,{ticks:u({},e,{last_id:-1,data:{}})},this._epoch-1,!1),!(i=this._getByPath(["ticks",e])).proxy){i.proxy=p(i.data,i);["last_price","average","highest","lowest","ask_price1","ask_volume1","bid_price1","bid_volume1","volume","amount","open_interest","datetime"].forEach(function(t){i.data[t]=p(i.data,i,function(e){return e?e[t]:NaN})})}return i.proxy}},{key:"setDefault",value:function(e){for(var t=arguments.length,i=new Array(1<t?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];for(var r="object"===d(i[0])?i[0]:this._data,o=0;o<i.length;o++)if("string"==typeof i[o]||"number"==typeof i[o]){if(!(i[o]in r))if(o+1===i.length){var s="string"==typeof e?c(e):e;r[i[o]]=s}else r[i[o]]={};r=r[i[o]]}return r}},{key:"_getByPath",value:function(e){for(var t=Object(a.c)(e),i=this._data,n=0;n<t.length&&void 0!==(i=i[t[n]]);n++);return n<t.length-1?{}:i}},{key:"mergeData",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];t&&(this._epoch+=1);var n=Array.isArray(e)?e:[e];for(var r in n){var o=n[r];null===o||Object(a.a)(o)||m(this._data,o,this._epoch,i)}t&&this._data._epoch===this._epoch&&this.fire("data",null)}},{key:"isChanging",value:function(e,t){for(var i=Object(a.c)(e),n=this._data,r=0;r<i.length;r++)if(void 0===(n=n[i[r]]))return!1;if("object"===d(n))return!(!n._epoch||n._epoch!==this._epoch);if(t){for(var o=t,s=0;s<i.length;s++)if(void 0===(o=o[i[s]]))return!1;return!0}return!1}}])&&l(i.prototype,n),r&&l(i,r),t}();t.a=y},function(e,t,n){"use strict";n.r(t),function(r){var v=n(2),g=n(4),o=n(0),s=n(1);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function u(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var e=function(e){function y(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=t.symbolsServerUrl,n=void 0===i?"https://openmd.shinnytech.com/t/md/symbols/latest.json":i,r=t.wsQuoteUrl,o=void 0===r?"wss://openmd.shinnytech.com/t/md/front/mobile":r,s=t.wsTradeUrl,a=void 0===s?"wss://t.shinnytech.com/trade/shinny":s,u=t.reconnectInterval,c=void 0===u?3e3:u,l=t.reconnectMaxTimes,f=void 0===l?5:l,h=t.prefix,_=void 0===h?"":h,d=t.needsQuotesService,p=void 0===d||d;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),(e=b(this,k(y).call(this))).version="1.0.12",e._symbol_services_url=n,e._prefix="TQJS_"+(_?_+"_":""),e.brokers=null,e.login_user_id="",e.login_bid="",e.login_password="",e.isQuotesInfoReady=!p,e.quotesInfo={},e._initQuotesInfo(),e.dm=new g.a;var m={reconnectInterval:c,reconnectMaxTimes:f};return e.quotesWs=new v.a(o,m),e.tradeWs=""===a||a===o?e.quotesWs:new v.a(a,m),e._initWebsocketsCb(),e}var t,i,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(y,o["a"]),t=y,(i=[{key:"_initQuotesInfo",value:function(){if(!this.isQuotesInfoReady){this.isQuotesInfoReady=!1;var t=this;this.quotesInfoPromise=fetch(this._symbol_services_url,{headers:{Accept:"application/json; charset=utf-8"}}).then(function(e){return e.json()}).then(function(e){return t.quotesInfo=e,t.isQuotesInfoReady=!0,Promise.resolve(e)}).then(function(){t.fire("ready")}).catch(function(e){return t.fire("error",e),Promise.reject("Error: "+e.message)})}}},{key:"_separateNotifies",value:function(e){for(var t=[],i=0;i<e.length;i++)if(e[i].notify){var n=e.splice(i--,1)[0].notify;for(var r in n)t.push(n[r])}return t}},{key:"on",value:function(e,t){"ready"===e?this.isQuotesInfoReady?t.call(this):this.once(e,t):"rtn_brokers"===e?this.brokers?t.call(this,this.brokers):this.once(e,t):("rtn_data"===e&&this.dm.isChanging("/")&&t.call(this),this.addEventListener(e,t))}},{key:"off",value:function(e,t){this.removeEventListener(e,t)}},{key:"_initWebsocketsCb",value:function(){var n=this;this.dm.addEventListener("data",function(){n.fire("rtn_data",null)}),this.tradeWs.addEventListener("message",function(e){if("rtn_brokers"===e.aid)n.brokers=e.brokers,n.fire("rtn_brokers",e.brokers);else if("rtn_data"===e.aid){for(var t=n._separateNotifies(e.data),i=0;i<t.length;i++)n.fire("notify",t[i]);n.dm.mergeData(e.data)}r(function(){n.tradeWs.send('{"aid":"peek_message"}')})}),this.tradeWs.addEventListener("reconnect",function(){n.is_logined()&&n.login({bid:n.login_bid,user_id:n.login_user_id,password:n.login_password})}),this.quotesWs.addEventListener("message",function(e){"rtn_data"===e.aid&&n.dm.mergeData(e.data),r(function(){n.quotesWs.send('{"aid":"peek_message"}')})}),this.tradeWs.addEventListener("reconnect",function(){n.dm._data.ins_list&&n.subscribe_quote(n.dm._data.ins_list)})}},{key:"update_data",value:function(e){this.dm.mergeData(e,!0,!1)}},{key:"get_by_path",value:function(e){return this.dm._getByPath(e)}},{key:"get_quotes_by_input",value:function(e){if("string"!=typeof e&&!e.input)return[];var t={input:"string"==typeof e?e.toLowerCase():e.input.toLowerCase(),instrument_id:!e.instrument_id||e.instrument_id,pinyin:!e.pinyin||e.pinyin,include_expired:!!e.include_expired&&e.include_expired,FUTURE:!e.future||!!e.future,FUTURE_INDEX:!!e.future_index&&!!e.future_index,FUTURE_CONT:!!e.future_cont&&!!e.future_cont,OPTION:!!e.option&&!!e.option,COMBINE:!!e.combine&&!!e.combine},i=function(e,t,i){return!(!e[t.class]||!e.include_expired&&(e.include_expired||t.expired))&&("instrument_id"===i&&(t.product_id.toLowerCase()===e.input||t.instrument_id.toLowerCase()===e.input)||"pinyin"===i&&-1<t.py.split(",").indexOf(e.input))},n=[];if(t.instrument_id)for(var r in this.quotesInfo)i(t,this.quotesInfo[r],"instrument_id")&&n.push(r);if(t.pinyin)for(var o in this.quotesInfo)i(t,this.quotesInfo[o],"pinyin")&&n.push(o);return n}},{key:"get_quote",value:function(e){if(""===e)return{};var t=this.dm.setDefault("quote","quotes",e);if(!t.class&&this.quotesInfo[e]){var i=t.last_price?t.last_price:this.quotesInfo[e].last_price;Object.assign(t,this.quotesInfo[e],{last_price:i})}return t}},{key:"get_account_id",value:function(){return this.login_user_id}},{key:"get_positions",value:function(){return this.is_logined()?this.dm.setDefault({},"trade",this.login_user_id,"positions"):null}},{key:"get_trades",value:function(){return this.is_logined()?this.dm.setDefault({},"trade",this.login_user_id,"trades"):null}},{key:"get_position",value:function(e){return this.is_logined()?this.dm.setDefault("position","trade",this.login_user_id,"positions",e):null}},{key:"get_orders",value:function(){return this.is_logined()?this.dm.setDefault({},"trade",this.login_user_id,"orders"):null}},{key:"get_order",value:function(e){return this.is_logined()?this.dm.setDefault("order","trade",this.login_user_id,"orders",e):null}},{key:"get_accounts",value:function(){return this.is_logined()?this.dm.setDefault("account","trade",this.login_user_id,"accounts"):null}},{key:"get_account",value:function(){0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.login_user_id;var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"CNY";return this.is_logined()?this.dm.setDefault("account","trade",this.login_user_id,"accounts",e):null}},{key:"get_trading_day",value:function(){if(this.login_user_id){var e=this.get_by_path(["trade",this.login_user_id,"session","trading_day"]);return e&&"string"==typeof e?e:""}return""}},{key:"get_klines",value:function(e,t){return this.dm.getKlines(e,t)}},{key:"get_ticks",value:function(e){return this.dm.getTicks(e)}},{key:"is_logined",value:function(){return!(!this.login_user_id||!this.get_trading_day())}},{key:"is_changed",value:function(e,t){return e._epoch?e._epoch===this.dm._epoch:"string"==typeof e&&this.dm.isChanging(e,t)}},{key:"insert_order",value:function(e){if(!this.is_logined())return null;var t=this._prefix+Object(s.b)(8),i={user_id:this.login_user_id,order_id:t,exchange_id:e.exchange_id,instrument_id:e.ins_id,direction:e.direction,offset:e.offset,price_type:e.price_type?e.price_type:"LIMIT",limit_price:Number(e.limit_price),volume_condition:"ANY",time_condition:"ANY"===e.price_type?"IOC":"GFD"},n=Object.assign({aid:"insert_order",volume:e.volume},i);this.tradeWs.send(n);var r=Object.assign({volume_orign:e.volume,status:"ALIVE",volume_left:e.volume},i);return this.dm.mergeData({trade:a({},this.login_user_id,{orders:a({},t,r)})},!1,!1),this.get_order(t)}},{key:"auto_insert_order",value:function(e){if(!this.is_logined())return null;var t={price_type:e.price_type?e.price_type:"LIMIT",volume_condition:"ANY",time_condition:"ANY"===e.price_type?"IOC":"GFD",exchange_id:e.exchange_id,instrument_id:e.ins_id,direction:e.direction,limit_price:Number(e.limit_price)};if("SHFE"===e.exchange_id&&"CLOSE"===e.offset){var i=this.dm.getPosition(e.symbol,this.login_user_id),n=0;"BUY"===e.direction&&0<i.volume_short_today?n=Math.min(i.volume_short_today,e.volume):"SELL"===e.direction&&0<i.volume_long_today&&(n=Math.min(i.volume_long_today,e.volume)),0<n&&this.insert_order(Object.assign({offset:"CLOSETODAY",volume:n},t)),0<e.volume-n&&this.insert_order(Object.assign({offset:"CLOSE",volume:e.volume-n},t))}else this.insert_order(Object.assign({offset:e.offset,volume:e.volume},t))}},{key:"cancel_order",value:function(e){this.tradeWs.send({aid:"cancel_order",user_id:this.login_user_id,order_id:e.order_id?e.order_id:e})}},{key:"login",value:function(e){this.login_bid=e.bid,this.login_user_id=e.user_id,this.login_password=e.password,this.tradeWs.send({aid:"req_login",bid:e.bid,user_name:e.user_id,password:e.password})}},{key:"confirm_settlement",value:function(){this.tradeWs.send({aid:"confirm_settlement"})}},{key:"transfer",value:function(e){this.tradeWs.send({aid:"req_transfer",bank_id:e.bank_id,bank_password:e.bank_password,future_account:e.future_account,future_password:e.future_password,currency:"CNY",amount:e.amount})}},{key:"subscribe_quote",value:function(e){this.quotesWs.send({aid:"subscribe_quote",ins_list:Array.isArray(e)?e.join(","):e})}},{key:"set_chart",value:function(e){var t={};e.trading_day_start||e.trading_day_count?(t.trading_day_start=e.trading_day_start?e.trading_day_start:0,t.trading_day_count=e.trading_day_count?e.trading_day_count:864e11):(t.view_width=e.view_width?e.view_width:500,e.left_kline_id?t.left_kline_id=e.left_kline_id:e.focus_datetime&&(t.focus_datetime=e.focus_datetime,t.focus_position=e.focus_position?e.focus_position:0)),this.quotesWs.send(Object.assign({aid:"set_chart",chart_id:e.chart_id?e.chart_id:this._prefix+"kline_chart",ins_list:e.ins_list?e.ins_list.join(","):e.symbol,duration:e.duration},t))}}])&&u(t.prototype,i),n&&u(t,n),y}();t.default=e}.call(this,n(6).setImmediate)},function(e,r,o){(function(e){var t=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function n(e,t){this._id=e,this._clearFn=t}r.setTimeout=function(){return new n(i.call(setTimeout,t,arguments),clearTimeout)},r.setInterval=function(){return new n(i.call(setInterval,t,arguments),clearInterval)},r.clearTimeout=r.clearInterval=function(e){e&&e.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(t,this._id)},r.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},r.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},r._unrefActive=r.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},o(7),r.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,r.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,o(3))},function(e,t,i){(function(e,d){!function(i,n){"use strict";if(!i.setImmediate){var r,o,t,s,e,a=1,u={},c=!1,l=i.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(i);f=f&&f.setTimeout?f:i,r="[object process]"==={}.toString.call(i.process)?function(e){d.nextTick(function(){_(e)})}:function(){if(i.postMessage&&!i.importScripts){var e=!0,t=i.onmessage;return i.onmessage=function(){e=!1},i.postMessage("","*"),i.onmessage=t,e}}()?(s="setImmediate$"+Math.random()+"$",e=function(e){e.source===i&&"string"==typeof e.data&&0===e.data.indexOf(s)&&_(+e.data.slice(s.length))},i.addEventListener?i.addEventListener("message",e,!1):i.attachEvent("onmessage",e),function(e){i.postMessage(s+e,"*")}):i.MessageChannel?((t=new MessageChannel).port1.onmessage=function(e){_(e.data)},function(e){t.port2.postMessage(e)}):l&&"onreadystatechange"in l.createElement("script")?(o=l.documentElement,function(e){var t=l.createElement("script");t.onreadystatechange=function(){_(e),t.onreadystatechange=null,o.removeChild(t),t=null},o.appendChild(t)}):function(e){setTimeout(_,0,e)},f.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var n={callback:e,args:t};return u[a]=n,r(a),a++},f.clearImmediate=h}function h(e){delete u[e]}function _(e){if(c)setTimeout(_,0,e);else{var t=u[e];if(t){c=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i)}}(t)}finally{h(e),c=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,i(3),i(8))},function(e,t){var i,n,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(e){i=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var u,c=[],l=!1,f=-1;function h(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&_())}function _(){if(!l){var e=a(h);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new d(e,t)),1!==c.length||l||a(_)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}}]).default});